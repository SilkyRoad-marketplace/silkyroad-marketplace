<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Silky Road Marketplace</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="/favicon.png" />

  <style>
    :root{
      --bg:#0b0b0b;
      --bg-2:#121212;
      --text:#ffffff;
      --muted:#b5b5b5;
      --accent:#d4af37; /* gold */
      --border:#222;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:#0b0b0b;color:var(--text)}
    a{text-decoration:none;color:inherit}

    /* ================= HEADER ================= */
    header{position:sticky;top:0;z-index:1000;background:var(--bg);border-bottom:1px solid var(--border)}

    /* ----- ROW 1 ----- */
    .header-top{
      display:flex;align-items:center;gap:14px;
      padding:10px 16px;
    }
    .logo img{height:36px;width:auto;display:block}

    .search-desktop{flex:1}
    .search-desktop input{
      width:100%;padding:10px 12px;border-radius:6px;border:1px solid var(--border);
      background:var(--bg-2);color:#fff
    }

    .header-actions{display:flex;align-items:center;gap:10px}
    .btn{
      padding:8px 12px;border-radius:6px;font-size:14px;cursor:pointer;
      border:1px solid var(--border);background:var(--bg-2);color:#fff
    }
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#000;font-weight:600}
    .icon-btn{font-size:20px;padding:6px}

    /* ----- ROW 2 (CATEGORIES) ----- */
    .cat-bar{background:#000;border-top:1px solid var(--border)}
    .cat-list{display:flex;gap:18px;padding:10px 16px;overflow:hidden}
    .cat-item{position:relative;font-size:14px;white-space:nowrap}
    .cat-item>a{color:#ddd}
    .cat-item:hover>a{color:var(--accent)}

    .dropdown{
      display:none;position:absolute;top:100%;left:0;min-width:220px;
      background:#000;border:1px solid var(--border);border-radius:8px;padding:8px 0
    }
    .dropdown a{display:block;padding:8px 14px;font-size:14px;color:#ccc}
    .dropdown a:hover{background:#111;color:var(--accent)}

    .cat-item:hover>.dropdown{display:block}

    /* MORE MENU */
    .more-menu>.dropdown{right:0;left:auto}

    /* ================= MOBILE ================= */
    .hamburger{display:none;font-size:22px}
    .mobile-search{display:none;padding:10px 16px;border-bottom:1px solid var(--border)}
    .mobile-search input{width:100%;padding:10px;border-radius:6px;border:1px solid var(--border);background:var(--bg-2);color:#fff}

    /* SIDE DRAWER */
    .drawer{
      position:fixed;top:0;left:-280px;width:280px;height:100%;
      background:#000;border-right:1px solid var(--border);transition:.25s;z-index:2000;
      display:flex;flex-direction:column
    }
    .drawer.open{left:0}
    .drawer-header,.drawer-footer{padding:14px;border-bottom:1px solid var(--border)}
    .drawer-footer{margin-top:auto;border-top:1px solid var(--border);border-bottom:0}
    .drawer a{display:block;padding:10px 14px;color:#ddd}
    .drawer a:hover{background:#111;color:var(--accent)}
.drawer-body {
  padding: 6px 0;
}

.drawer-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 14px;
  cursor: pointer;
  color: #ddd;
}

.drawer-item:hover {
  background: #111;
  color: var(--accent);
}

.drawer-back {
  font-weight: 600;
  color: var(--accent);
}

    /* ================= PRODUCTS ================= */
    .container{padding:24px 16px;max-width:1200px;margin:auto}
    h2{margin:0 0 16px}

    .grid{display:grid;gap:16px}
    .grid-4{grid-template-columns:repeat(4,1fr)}

    .product{
      background:#111;border:1px solid var(--border);border-radius:12px;padding:12px
    }
    .product img{width:100%;border-radius:8px}
    .product h3{font-size:15px;margin:8px 0 4px}
    .product p{font-size:13px;color:#aaa;margin:0}

    /* ================= RESPONSIVE ================= */
    @media(max-width:1024px){
      .search-desktop{display:none}
      .cat-bar{display:none}
      .hamburger{display:block}
      .mobile-search{display:block}
    }
    @media(max-width:768px){
      .grid-4{grid-template-columns:1fr}
    }
  .search-wrap {
  position: relative;
  flex: 1;
}

.search-wrap input {
  width: 100%;
  padding: 10px 36px 10px 12px;
}

.clear-x {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #888;
  cursor: pointer;
}

  </style>
</head>
<body>
<header>
  <!-- ROW 1 -->
  <div class="header-top">
    <button class="hamburger icon-btn" onclick="toggleDrawer()">‚ò∞</button>

    <a class="logo" href="index.html">
      <img src="logo.png" alt="Silky Road" />
    </a>

    <div class="search-desktop search-wrap">
      <input
        id="searchInputDesktop"
        type="search"
        placeholder="Search products‚Ä¶"
        oninput="handleSearch(this.value)"
      />
      <button class="clear-x" onclick="clearSearch()">‚úï</button>
    </div>

    <div class="header-actions">
      <a data-when="logged-out" href="login.html">Login</a>
      <a data-when="logged-out" href="sign_up.html">Start Selling</a>

      <a data-when="logged-in" href="library.html">Library</a>
      <a data-when="logged-in" href="dashboard.html">Dashboard</a>

      <a class="icon-btn" href="checkout.html">üõí</a>
    </div>
  </div>

  <!-- ROW 2 -->
  <nav class="cat-bar">
    <div class="cat-list">
      <!-- categories unchanged -->
    </div>
  </nav>
</header>


<!-- SIDE DRAWER -->
<div class="drawer" id="drawer">
  <div class="drawer-header">
    <span class="drawer-close" onclick="toggleDrawer()">‚úï</span>
<a data-when="logged-out" href="login.html">Login</a>
<a data-when="logged-out" href="sign_up.html">Start Selling</a>

<a data-when="logged-in" href="library.html">Library</a>
<a data-when="logged-in" href="dashboard.html">Dashboard</a>


  </div>
  <div id="drawerCategories" class="drawer-body"></div>
<div class="drawer" id="drawer">
  <div class="drawer-header">
    <span class="drawer-close" onclick="toggleDrawer()">‚úï</span>

    <a data-when="logged-out" href="login.html">Login</a>
    <a data-when="logged-out" href="sign_up.html">Start Selling</a>

    <a data-when="logged-in" href="library.html">Library</a>
    <a data-when="logged-in" href="dashboard.html">Dashboard</a>
  </div>

  <div id="drawerCategories"></div>
</div>



<!-- FEATURED PRODUCTS -->
<section class="container">
  <h2>Featured Products</h2>
  <div class="grid grid-4">
    <div class="product"><img src="https://via.placeholder.com/300x200" /><h3>Product 1</h3><p>$19</p></div>
    <div class="product"><img src="https://via.placeholder.com/300x200" /><h3>Product 2</h3><p>$29</p></div>
    <div class="product"><img src="https://via.placeholder.com/300x200" /><h3>Product 3</h3><p>$9</p></div>
    <div class="product"><img src="https://via.placeholder.com/300x200" /><h3>Product 4</h3><p>$49</p></div>
  </div>
</section>

<script type="module">
  import { supabase, initAuthUI } from "/js/auth.js";

  initAuthUI();

  /* DRAWER */
  window.toggleDrawer = function () {
    document.getElementById("drawer").classList.toggle("open");
  };

  /* SEARCH */
  window.clearSearch = function () {
  const el = document.getElementById("searchInputDesktop");
  el.value = "";
  handleSearch("");
};


 let CATEGORIES_CACHE = [];

async function loadCategories() {
  const { data, error } = await supabase
    .from("categories")
    .select("id, name, slug, subcategories(id, name, slug)")
    .order("name");

  if (error) {
    console.error(error);
    return;
  }

  CATEGORIES_CACHE = data;
  renderCategoryList();
}

/* ---------- MAIN CATEGORY VIEW ---------- */
function renderCategoryList() {
  const drawer = document.getElementById("drawerCategories");

  drawer.innerHTML = `
    <a class="drawer-item" href="/marketplace.html">ALL</a>
  `;

  CATEGORIES_CACHE.forEach(cat => {
    drawer.innerHTML += `
      <div class="drawer-item" onclick="openSubcategories('${cat.id}')">
        <span>${cat.name}</span>
        <span>‚Ä∫</span>
      </div>
    `;
  });
}

/* ---------- SUBCATEGORY VIEW ---------- */
window.openSubcategories = function (categoryId) {
  const cat = CATEGORIES_CACHE.find(c => c.id === categoryId);
  if (!cat) return;

  const drawer = document.getElementById("drawerCategories");

  drawer.innerHTML = `
    <div class="drawer-item drawer-back" onclick="renderCategoryList()">
      ‚Üê Back
    </div>
    <a class="drawer-item" href="/c/${cat.slug}">
      All ${cat.name}
    </a>
  `;

  cat.subcategories.forEach(sub => {
    drawer.innerHTML += `
      <a class="drawer-item"
         href="/c/${cat.slug}/${sub.slug}">
        ${sub.name}
      </a>
    `;
  });
};


  loadCategories();
</script>

</body>
</html>
