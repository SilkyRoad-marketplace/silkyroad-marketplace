<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Support – Silky Road Marketplace</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" href="/favicon.png">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div id="header-root"></div>

  <main class="page">
    <section class="page-header">
      <h1>Contact support</h1>
      <p class="muted">Need a hand? We&apos;re here for you.</p>
    </section>

    <section class="text-block">
      <p>Got a question about selling, payouts, or your products? Send us a message and we&apos;ll get back to you shortly.</p>
      <button id="open-support-modal" class="btn btn-primary">Contact support</button>
    </section>

    <div id="support-modal" class="modal-backdrop">
      <div class="modal">
        <button class="modal-close" id="support-close" aria-label="Close">&times;</button>
        <h2>How can we help you today?</h2>
        <form id="support-form" class="support-form">
          <label class="field">
            <span>Your email address</span>
            <input type="email" id="support-email" required>
          </label>
          <label class="field">
            <span>Subject</span>
            <input type="text" id="support-subject" required>
          </label>
          <label class="field">
            <span>Tell us about your issue or question…</span>
            <textarea id="support-message" rows="5" required></textarea>
          </label>
          <button type="submit" class="btn btn-primary btn-full">Send message</button>
        </form>
      </div>
    </div>
  </main>

  <div id="footer-root"></div>

  <script type="module" src="/js/header-main.js"></script>
  <script type="module" src="/js/footer.js"></script>
  <script>
    const openBtn = document.getElementById("open-support-modal");
    const modal = document.getElementById("support-modal");
    const closeBtn = document.getElementById("support-close");
    const form = document.getElementById("support-form");

    openBtn?.addEventListener("click", () => {
      modal.classList.add("open");
    });

    closeBtn?.addEventListener("click", () => {
      modal.classList.remove("open");
    });

    modal?.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.remove("open");
    });

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("support-email").value.trim();
      const subject = document.getElementById("support-subject").value.trim();
      const message = document.getElementById("support-message").value.trim();

      try {
        const res = await fetch("/api/support", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, subject, message })
        });
        if (!res.ok) throw new Error("Request failed");
        alert("Your message has been sent. Thank you!");
        modal.classList.remove("open");
        form.reset();
      } catch (err) {
        console.error(err);
        alert("Failed to send message. Please try again later.");
      }
    });
  </script>
</body>
</html>
